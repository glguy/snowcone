.\" Text automatically generated by txt2man
.TH snowcone 1 "06 November 2021" "snowcone" ""
.SH NAME
\fBsnowcone \fP- solanum server notice console
.SH SYNOPSIS
.nf
.fam C
\fBsnowcone\fP \fB-S\fP \fIaddress\fP \fB-N\fP \fInick\fP [\fB-U\fP \fIuser\fP] [\fB-G\fP \fIgecos\fP] [\fB-X\fP \fIpassword\fP]
         [\fB-O\fP \fIopername\fP] [\fB-K\fP \fIchallenge\fP] [\fB-M\fP \fImechanism\fP]
         [\fB-E\fP \fIsasluser\fP] [\fB-D\fP \fIsaslkey\fP] [\fB-Z\fP \fIsaslauthzid\fP]
         [\fB-C\fP \fIcapabilities\fP] [\fB-L\fP \fIinitfile\fP]
         [\fB-f\fP \fIfilename\fP] [\fB-l\fP \fIhost\fP] [\fB-p\fP \fIport\fP] [\fB-h\fP]
.fam T
.fi
.fam T
.fi
.SH DESCRIPTION
\fBsnowcone\fP provides a live view of server notices focused on awareness
of recent connections and disconnections to the network. It can show
information about the most recent connections as well as various load
meters split by server and operators. It does this with a run-time
editable scripting environment to support rapidly adapting to the
needs of the current situation.
.PP
Instead of bundling its own network connection support, \fBsnowcone\fP relies
on the socat application to make network connections. This allows
\fBsnowcone\fP to natively support a wide range of network connection options.
.SH OPTIONS
.TP
.B
\fB-S\fP \fIaddress\fP
specify the IRC server to connect to using \fBsocat\fP(1)
argument syntax.
.TP
.B
\fB-N\fP \fInick\fP
IRC nickname (NICK)
.TP
.B
\fB-U\fP \fIuser\fP
IRC username (USER)
.TP
.B
\fB-G\fP \fIgecos\fP
IRC \fIgecos\fP/realname (USER)
.TP
.B
\fB-X\fP \fIpassword\fP
IRC \fIpassword\fP (PASS)
.TP
.B
\fB-O\fP \fIopername\fP
IRC operator username (OPER and CHALLENGE)
.TP
.B
\fB-K\fP \fIchallenge\fP
Path to RSA key for CHALLENGE. Challenge support requires
you to install an extra Lua dependency with: luarocks install openssl
.TP
.B
\fB-M\fP \fImechanism\fP
SASL \fImechanism\fP
.TP
.B
\fB-E\fP \fIsasluser\fP
SASL username
.TP
.B
\fB-D\fP \fIsaslkey\fP
Path to PEM or DER encoded key file
.TP
.B
\fB-Z\fP \fIsaslauthzid\fP
SASL authorization ID (uncommon)
.TP
.B
\fB-C\fP \fIcapabilities\fP
Extra space-delimited \fIcapabilities\fP to request upon connect (CAP REQ)
.TP
.B
\fB-L\fP \fIinitfile\fP
Path to Lua logic entry point
.TP
.B
\fB-f\fP \fIfilename\fP
Path to Lua network configuration
.TP
.B
\fB-l\fP \fIhost\fP
Binding \fIhost\fP for Lua console
.TP
.B
\fB-p\fP \fIport\fP
Binding TCP \fIport\fP for Lua console
.TP
.B
\fB-h\fP
print this usage information
.SH ENVIRONMENT
Sensitive arguments are passed using environment variables to keep them
out of the process list.
.TP
.B
IRC_PASSWORD
IRC \fIpassword\fP (PASS)
.TP
.B
IRC_SASL_PASSWORD
IRC account \fIpassword\fP
.TP
.B
IRC_OPER_PASSWORD
IRC operator \fIpassword\fP (OPER)
.SH SOCAT ADDRESSES
Check the \fBsocat\fP(1) man page for an exhaustive set of connection
addresses, but these will be the most commonly used:
.TP
.B
TCP:server:6667
Connect to a plain-text IRC server
.TP
.B
OPENSSL:server:6697,certificate=cert.pem
Connect to a TLS-enabled IRC server using a client-side certificate
.SH LUA CONSOLE
When a Lua console \fIport\fP is specified, \fBsnowcone\fP will listen for
connections on that \fIport\fP and provide a Lua console with access
to \fBsnowcone\fP's internal state. This can be useful for developing
\fBsnowcone\fP or adding custom logic at runtime. Calls to print from
inside a console will be piped back to that console.
.SH MODES
.TP
.B
F1
recent connections
.TP
.B
F2
server connection load
.TP
.B
F3
recent exits
.TP
.B
F4
server exit load
.TP
.B
F5
bans
.TP
.B
F6
channel creates and floods
.TP
.B
F7
network-mask connection tracker
.TP
.B
F8
raw IRC console
.TP
.B
C-n
next view
.TP
.B
C-p
previous view
.TP
.B
C-s
live filtering mode
.TP
.B
C-u
kill to beginning of buffer
.TP
.B
C-k
kill to end of buffer
.TP
.B
C-w
kill previous word
.TP
.B
M-d
kill next word
.TP
.B
C-y
paste yanked region
.TP
.B
C-a
move to beginning of buffer
.TP
.B
C-e
move to end of buffer
.TP
.B
C-f
move right
.TP
.B
C-b
move left
.TP
.B
C-t
swap characters
.TP
.B
M-f
next word
.TP
.B
M-b
previous word
.TP
.B
UP
older command history
.TP
.B
DOWN
newer command history
.TP
.B
PgUp
scroll up
.TP
.B
PgDn
scroll down
.TP
.B
Esc
clear filters, reset scroll, clear status message
.SH SH RECENT CONNECTIONS
The recent connections view has a number of special features. Click on
a connection to select it for kline or unkline. The buttons below will
allow you to set kline reasons, durations, and to see the number of
affected users before you commit to the action.
.TP
.B
Q
only live connections
.TP
.B
W
only dead connections
.TP
.B
E
all connections
.TP
.B
K
issue kline
.PP
The first column shows when a \fIuser\fP connected. It fades from white a
character per second to indicate the most recent connections. Times
are displayed in UTC.
.PP
The second column usually shows reconnection counts for that nickname.
When a client triggers a server-side filter, this counter will switch
to showing the number of times this connection has tripped a filter.
This is indicated with an exclamation point after the number.
.PP
The third column shows the nickname, username, and hostname of the
connected \fIuser\fP. It will be green while the \fIuser\fP is connected and turns
red when the \fIuser\fP disconnects. It updates when a \fIuser\fP changes nicknames.
.PP
The fourth column can show disconnect reasons, IP addresses, and GeoIP
ASN names (in that order of preference). You can override that preference
by cycling through modes using the first button in the toolbar.
.PP
The fifth column shows the server the \fIuser\fP is connected to.
.PP
The sixth column shows the SASL identified account name for the \fIuser\fP,
if applicable, as well as the GECOS field.
.SH SERVER LOAD
The server load views (for connections and disconnections) provide a
view of the load rates as well as the current state of the DNS
rotations. Each column heading can be clicked in order to chose a
sort order for this view.
.PP
The rotating bar graphs show the number of events per second for the
last minute. The bar graphs max out at 8 events per second.
.PP
The load averages give an approximation of the number of connections
per second in either the last 1, 5, or 15 minutes. These varying
time windows can help interpret the numbers as showing when rates
are increasing or decreasing over time and to help put spikes into
perspective.
.PP
The various columns full of 4 and 6 show which servers have known
IPv4 and IPv6 \fIaddress\fP. They turn yellow when that \fIaddress\fP is in
the DNS rotation corresponding to the column.
.PP
The Mn column shows the MAIN rotation. The region column shows the
region a server is in and if the server is in that region's DNS
rotation. The AF column shows the IPV4 and IPV6 rotations.
.PP
The Conns column shows the number number of connections for that
server.
.PP
The Up column shows the server this server is linked to in the
direction of the configured primary_hub.
.SH RAW CLIENT
The raw client view (F8) is primarily intended for debugging. It exists
to see what \fBsnowcone\fP sees. To see details about any one message, click
on its command text.
.SH COMMANDS
You can run client commands from any window. When you startup typing
a command with a '/' character, the input buffer will replace the last
line in the client.
.TP
.B
/eval luacode
Evaluate arbitrary Lua code
.TP
.B
/filter pattern
Update the recent connection filter
using Lua pattern syntax
.TP
.B
/nettrack label \fIaddress\fP/prefix
Add a network to the F7 tracking view
.TP
.B
/quote raw_command
Send a raw IRC command
.TP
.B
/reload
Reload Lua files
.TP
.B
/sync
Manually refresh \fIuser\fP counts
.TP
.B
/addwatch pattern
Add a new watch
.TP
.B
/delwatch number
Remove watch by number
.TP
.B
/banload
Load meters for kline setting
.TP
.B
/spamload
Load meters for filter events
.TP
.B
/repeats
List of repeated connections by nicknames and masks
.TP
.B
/stats
Internal client metrics
.TP
.B
/versions
Populate the server list version column
.TP
.B
/uptimes
Populate the server list startup column
.SH GEOIP SUPPORT
Both legacy GeoIP and modern GeoIP Maxmind database are supported
and will be used if they are found at startup time.
.SH NETWORK CONFIGURATION
Information about your network can be populated in the servers
configuration file. The MAIN, IPV4, and IPV6 regions get special
rendering treatment in the server list.
.PP
.nf
.fam C
        {
          primary_hub = 'hub.irc.tld',
          regions = {
            MAIN = { hostname = 'irc.tld' },
            US   = { hostname = 'us.irc.tld', color = 'red' },
          },
          servers = {
            'xyz.irc.tld' =
              { alias = 'Xy', region = 'US',
                ipv4 = '192.0.2.1', ipv6 = '2001:db8::16' }
          },
          kline_reasons = {
            { 'banned', 'You are banned.' },
          },
        }
.fam T
.fi
.SH SASL SUPPORT
The SASL username is specified using \fB-E\fP.
.PP
All SASL passwords are passed by the IRC_SASL_PASSWORD environment
variable. For \fIpassword\fP-based authentication mechanisms the \fIpassword\fP
will be used as your credential. For asymmetric cryptography
mechanisms, this will be used to decrypt the private key.
.PP
Private key files are specified with \fB-D\fP. These can be either PEM
or DER encoded files. This is automatically detected.
.PP
An optional (and very uncommon) authorization identity can be specified
with \fB-Z\fP.
.TP
.B
PLAIN
Uses \fB-E\fP, \fB-Z\fP and IRC_SASL_PASSWORD
.TP
.B
EXTERNAL
Uses \fB-Z\fP
.TP
.B
ECDH-X25519-CHALLENGE
Uses \fB-E\fP, \fB-Z\fP, \fB-D\fP, and IRC_SASL_PASSWORD
.TP
.B
ECDSA-NIST256P-CHALLENGE
Uses \fB-E\fP, \fB-Z\fP, \fB-D\fP, and IRC_SASL_PASSWORD
.TP
.B
SCRAM-SHA-1
Uses \fB-E\fP, \fB-Z\fP, and IRC_SASL_PASSWORD
.TP
.B
SCRAM-SHA-256
Uses \fB-E\fP, \fB-Z\fP, and IRC_SASL_PASSWORD
.TP
.B
SCRAM-SHA-512
Uses \fB-E\fP, \fB-Z\fP, and IRC_SASL_PASSWORD
.SH FILES
.TP
.B
~/.config/\fBsnowcone\fP/servers.lua
Lua syntax table specifying server addresses and regions.
.TP
.B
/usr/share/\fBsnowcone\fP/lua
Lua run-time source files. These can be edited at runtime. Specify
an alternative entry point with \fB-L\fP.
.TP
.B
GeoLite2-ASN.mmdb
If the mmdb Lua library is installed, and the GeoLite2-ASN.mmdb
database is in the current directory, \fBsnowcone\fP will use it to provide
more information about recent connections.
.SH AUTHOR
\fBsnowcone\fP was written by Eric Mertens <glguy@libera.chat> and is published
under the ISC license.
